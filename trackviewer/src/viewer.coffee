class @TrackViewer

  constructor: () ->
    @sheets = 0
    @sheetsLoaded = 0

  init: (context, mapData) ->
    @spriteManager = new SpriteManager(context)

    imBalls = new Image()
    imBalls.addEventListener "load", (e) => @imageLoaded(context, "balls", imBalls, 8, 4, 13, 13)
    imBalls.src = "data:image/gif;base64,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"
    @sheets++

    imElements = new Image()
    imElements.addEventListener "load", (e) => @imageLoaded(context, "elements", imElements, 24, 4, 15, 15)
    imElements.src = "data:image/gif;base64,R0lGODlhQQBhAPcAAMzMzMb2AR6EHfz+/v7+/PL58/78/vz9+v76/vr//vz//Pz8/9vw2/n8+vn7+Or16v/8++P04ej25Pj79fn6/+347vz9/fb89/37+sbGxhOnE////wAA/7foDJ52Ar3h5NbWhP+wcF43ACfDJwGRAQmbCQByAACFAQF5ABuyGyO6I9nZ2f///ri4uLa2tsvLy/7////+/x+jHx2SHhicGP7//v/+/iWlJSKrIgF/Af7+//7+/sTExLOzs8LCwvL387u7uwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAQQBhAAAI/gA3CBxIsKBAGCw2sEi4QccGGA9jxHjIAqLCiQc3YKyYkAWEBAgIJFiAAQaChAMObNDAsqXLlyw8yJxJsyYMEThz6twJ44PPn0CDKlj5smjLDTWT0oyxs6nOBUGjAjVA1GhRpEqVsnDKdYPUrwmqWnUZM2vSm1ybQv0aVeDYq2aT6kjb1ADbqBPfvsQad+ZWujp13A3qVu/RvksB67QxGCgEsXprIParOCeCxj8RQH4LY7JMtJUHYPZJYPPYspM3VMZpdzRVwy1tePbAdLXo0QtqwGaJGrHq1Wsxv97NF/Hc1YJxm7ZavO/fypdHl96tIcbs35VZjP4AEcaBAgwY/jxowNDGDhg1HiKEYWBA+oYRBcYoPdAGQoELD9awQWAhjAEstBdDAjUsoMMAYW2QwoIMNuhgDSVEKOGEFG6AwoUYZqghDCZ06OGHIArk4IgNbkDhiROyoOGKGe4A4osfIkTijCaiiKKFLLK4AYw8bqDAjCTGYCOKMeTIog48wrjBACTSQKIFQ56II4YCVMmiAUm+uOSINHQ5IgsU3iCmmBTqsGKVAqzoIoxVgpiQg13G6aANYY55A4Uqnmllizy2+SELNjQop5wMgokimSnmiGaGA/QpQIg1COrkgl4ySICNiEpYpJ5pZrjjh2j66aFGgsLZIAyY3jkhDJyqCWKo/o/+yQKQI6Ia5aoaLrqiBVmGqCCtDV56q4RTGokhr716yEIMwDZI57AR5mkshlgm2+FCzTL4LLTFTmuDtR2KmG0KEEJbgpnTYrimtRvYUEMMNijQgAMWuBuDDjYs+1B67ipgwA4EOHBBAQ4oYIMOFACKwAQF/DBBAwBCoMACAwylgHcDAHjvAgoUEEEEBE90wsgkl2yyDiSkrPLKLA+gwsswxywzASPUbPPNOKtk8s4lG8DyzysTIPPQMSeA89E3FxADz0xbAPTTCRAt9QZIV/3ABkzzvMHTQAst9dALVI10BTBkvfPWXLcstQxsx0y12DhfgDXJM5hcN8kssJxD/g5PG0A02zLIbPTNOBReOM5UlTzD3ScsXjLaKu/99AZDAz40BjgbfvjNNsw98uJ1g96z3nwDrYDMlg+NQOY4VI2Q3aAzPrLPK+9tO8uUo962zDqwXnV6O4tuMgyk377yBH/vDnMMviO9H8+y4502yxKsrbwKNMN985JmDz/9ygx8PfTg2tcsUPclE/99ytWLX3T5NleEPsmQf3+B+zErAH/NA3iOvvrrswH+YLa6/dHHAgybQMFgQLEa6CBABNDBDioCg//YpwEViEAFDgCRBcyHABWzwQICZAMILOAgGJhgDKgyn/3EACE7qEENDGADDtjwhjjM4QY6wMMe+vCH/kThgEuEOEQNVCUALUHiVWqQwybiMAY/jKIPl2OUlSjRKkoUiBO3qAMpehEGRCRiEVsCA70oMQAbYOIWm7hDL0aRBdSJQRL1opA1stGNUbSBUcTIEiFu5op72YAdc1gDPAJxjH3cCyBdckUkanGQN7SBIaeoAT6O5Yh0FCQkbdjFSfJQjohsCRGpqAFAPnKTBPDkJ98iRg6U8SWLPIomNzkAVXYAjonMpSKJw4JN2pAFtiTlXubISJZkcZaQBKYqe7mbV8LmlJCEgS1xqUtRxgaQsTQmNAcJRVXqcY8vcSV1tmlHZXpSjpZkDjGNyU6WCKR/E6kBATZyn3ZZIAbv/qkgfh7CT4OgByL6Skh6MGKQggoEAAhNqEIVyoMNgOChEI2oRDcQgopa9KIY3cBCN5rQhm7gBRkIqUhHKtIWOFSiKIUoRTHKUot+lKQwDalJXxpTkpo0pThdaUtZStOallQgIPXpT3GaUp3u9KI9FepMgyrUDNyUqBM9Kk+ZqlSgNlWmJ4WqSqWaUar6dKlXdWpWtQoCo3I1qV+16lWfStaychWpXq0pWNc6Vq2aVapolatam8pWst71qHmN6Vz5Wleo/nWngYXpYKva1ocetqWJteleGdvYx041rItNa2Pd+taKRnakM/WBC0ZL2tKStgeFJaplMypa07rWBag11ahsZ0vb2tp2IEDIrW53y9sN8Pa3u/UtcIEr3OH2trjG1S1ykwuE5SbXucYVCHODO13lVje30B2udK+bXeJet7nf3W51l7uC8nqXu8At7wqOm97z7la9v0Xuet9LXd7Cl732NW9v06tf6+q2v/0F73sDrFzyqne+/v3tfbE74PUuWMC5fXBw5WveB0NXwgbGcH4RPOEB/5fDzpUwhD/MYQZvOL7ytW99Sexe+saXvyUW73S7+2L0cpfG+7XxeMOL4xXPOLw8BrKOf1zd2N72yEhOskACAgA7"
    @sheets++

    imShapes = new Image()
    imShapes.addEventListener "load", (e) => @imageLoaded(context, "shapes", imShapes, 28, 4, 15, 15)
    imShapes.src = "data:image/gif;base64,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"
    @sheets++

    imSpecial = new Image()
    imSpecial.addEventListener "load", (e) => @imageLoaded(context, "special", imSpecial, 28, 4, 15, 15)
    imSpecial.src = "data:image/gif;base64,R0lGODlhQQBxAPcAAAAAABQUFCUlJTIyMmEAAEZGRlxcXHFxcQgIuhcXyQAA/ycn2TAw4jY26Dw87kFB80ZG+EtL/SO6NDygPCvDPSb/PzXMRj7VT0TcVkviXFXsZlzzbWT7dZwAAKAAALoAALoIJcUUFMkXNMstLc44OP4AAP8AKtknROIwTe05VfRBXftJZP94eLqxCMO6EczDGtXMI9zTKuTbMv/yAO7lPPXsQ/30S4ODg5CQkKSkpLOzs/+mpsDAwMTExMzM//Dw8P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAQQBxAAAI/wCBCBxIsKDBgwgTKlzoo6HDhxCBQARAkWLEiRUBRPzBsaPHjwIhinwosWHGkw5L+jiZMeXHlx1xhBw5siRLlD5s3qzYEAhHHkCDCuWBQ6ZKmiRX7mwpcSnTn0OHFp2JNClLICxzKqVY8OmPqFKNVo14E+vVk2YBpOUKFSzQqUfHrq04l+vSuT6/un0rdmzKsoDL4m3rFq7fv2cTZxx4lTBYw4dzOkVLeWfevXyp+m06WSNnrgS9Yiba9/Bnp1o7e3YcFbJpk6i1bt3Zk3VYzXIdLk2pm3btosCDC8ddNS5O3g+P9xTOPPjC59CjSyeONG7xyLJNW++Rw4BI6xo1Xv+EyN37+OQrvx/twUPHDQPwk+pOL15+Q/bu4ZvviT68eoc96IDDewUYUMAAyClFn4L83ScggQYi2KCC/lnUU0k65DfAhhwKMOFWsyGX4XscdvghTy1d2FAOJJa4oYeyiYeTeCWxaMAAO7CQgokxmlRCCekFGZIOORzAIQslCuDhZw6VEB5PEhFp5A45lvDBi0uC2NCPIYZ0wAEHDrBCCR10GECMFQHpZH1afXngCipYWeYAApypEwBc/shmSC4OQICZdvaWHFM+lGilBwT8WWegsD20pkUzDRCmi3U2aKFFFjYo6YYdJPrimWhuCWSmOZVEZ5+LWgobpvWZKgClqfb/GGKmVCn5Kp0B5JogT0G26pCtWOo6Ia8ypnSUrYuCeuKTpB5ra657DhqisSLlqmyC0p7nkLXfjUSqipFZVx124tI03bnoTgdRBOyyq21uD60gr7zvFqdSu/i6+6FDCtTk0LwA07tvQybUVBIECCesMAQDK+Bwtz4ELPHAJlT83wMYZ6xxxtk15PDHF6kg8sgkj9yxDxWnHJFEDrTs8ssun3xdCjTXbHPNMlcHRAM8NzBSzw2o1K9IQ+dk80g2q1SwSEuXysDTUDPgQ9RQl/SwDyBjPTQQKHTtNQo+fO11SRajXHbZAi2g9toL+MD22hJljTW/DwNxwt14n+BD3nhL/6QywQ6pnPbbbRO+gNVFJ74133fvzTjZTUe+tEAJVG55Aj5cbrnQIxUNhAighy6CD6KHrvRITYekOear52wu6aXDLrrrBmeuOQKtx/Xx1byVLgIIvp+cctnU+oDA8cgnj0DDvCMHwvPQRw8CxcQXb7zyyGPLr78NSR+99oD/95Dy9Y77kPTlm5vu+uwbBJEN8MOfPvcOcWC//fOL70P8/Ms/sA8zoN/9Boi//1Wgdj6ogQIXyMAaDGwGEIQYASc4sApY8D8NzKACTwbBDl5kAyAMoQhDeDILmnBlPqCBClfIwhXSrlsaiKEMZyjDF65MBjiUwUhyKAOVBFAkP8zJDP9HMkOVHFAkRywVD3PogyXisCQRBGAUowiEDFjxihnwARavWJIL+uCEXzyiQGJAxjLGwAdmLKNEPNiQIHoQCBiIoxwx4IM5ylEiYPyiQ04oEBj48Y8w8AEg/whFNzqEihdIpCIv4INFKrKLSYykGIHwgkpa8gU+uKQlfTiSIALBAqAMpQV8IMpQGnEkSQyJJjG5ShsmpZSjhKUrqeWCWtrylrbkYAeDyB8K+PKXwPxlCU2YRHC14JjITGYLHhhF+UjgmdCMpgQq6EWSqESZyQQfAOknzWhqs5jWa4gy8/cuaZLTmu1L5/rIxc5wkUsiJBjBCD7gg3jOs57y/AA88yn/EnvqE5/3hIg/9xlQ9fngAx7wQAcOmtCFIlShEnnoQiEi0Yg2VCQVZahC7dXO17gzXEAIAUDp6U986lOkJU3pPMVVUm229EL0lKhGHQrRmF5UpgjtgLhkqk2egsujQN3MO0lAUn6m9J8NUWlBVaJUek7opSv7AE03ilOdOgSnF50QVjeq1azqT6gfDapcgBDPot6zpCEg61mNys+0IqWl5RopTKl605sCIaczzStSR8LTuPY1rhAT63VA2lS5qnWtBU1JYd8F1bnS9bELvWtduUqSrU7UPg3xqbHUyVl1hXUzMAltXkILEnGxSZun/U1zmOOT1bLWtPTrTWpbO5of/8jEthPIrW53OwHb4qZC7wIuSWxb29vigLfI9S14vpWz1OaEuJjxLW6Ru1vlzsck181OfbbrEhwUt7XUrW5pgpRdWXnrN9+dbnh7K5bjoOQ0232Kd6Nr3PXm1rrlJa95RUIj6O5Fuse1L37Jy91hZbdV/nULgO3LXuLwCrP5RS99wSvg8S7otMZZ0HDn+9/6Vpg6zl3ubBMMlgV/GLaBRc93SPuR27I4JtR5Xbhcy1oaD6ezOIZOR8EqWJ3tGF49NuhngczjzQD2nNqUsXZ+PNggI9DJKSbyWJlsPiijcMhNLvKUsVxlLXOUy0r2so/BHFspf9nKEM7yltGc5DKfWRHMYTbzmNn8vzjbK8d4PkhAAAA7"
    @sheets++

    @map = MapParser.parse(mapData)
    return

  imageLoaded: (context, sheetName, sheetImage, spriteCount, spritesPerColumn, spriteWidth, spriteHeight) ->
    @spriteManager.loadSheet(context, sheetName, sheetImage, spriteCount, spritesPerColumn, spriteWidth, spriteHeight)
    @sheetsLoaded++
    return

  drawMap: (context, x, y) ->
    @map.draw(context, @spriteManager, x, y)
    return

  isReady: () ->
    return @sheetsLoaded == @sheets
